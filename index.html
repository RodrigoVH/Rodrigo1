<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Notas de Exámenes</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial, sans-serif; background: #f0f2f5; padding: 10px; }
    h2 { margin: 10px 0; text-align: center; }
    .container { max-width: 380px; margin: auto; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input, select, button { width: 100%; margin: 10px 0; padding: 10px; font-size: 16px; border-radius: 8px; border: 1px solid #ccc; }
    button { background-color: #007bff; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #0056b3; }
    .hidden { display: none; }
    .note { margin: 5px 0; padding: 8px; background: #e0e0e0; border-radius: 5px; }
    .note.red { background: #f8d7da; }
    .note.green { background: #d4edda; }
    .btn-small { padding: 5px 10px; font-size: 12px; margin-left: 5px; }
    .auth-section { text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sección de autenticación (Login/Registro) -->
    <div id="auth-section">
      <h2>Iniciar Sesión</h2>
      <input id="login-username" placeholder="Nombre de usuario">
      <input id="login-password" placeholder="Contraseña" type="password">
      <button onclick="login()">Iniciar Sesión</button>
      <p>No tienes cuenta? <a href="javascript:void(0);" onclick="toggleRegister()">Registrarse</a></p>
    </div>

    <!-- Sección de registro -->
    <div id="register-section" class="hidden">
      <h2>Registrarse</h2>
      <input id="reg-username" placeholder="Nombre de usuario">
      <input id="reg-password" placeholder="Contraseña" type="password">
      <button onclick="register()">Registrarse</button>
      <p>¿Ya tienes cuenta? <a href="javascript:void(0);" onclick="toggleLogin()">Iniciar Sesión</a></p>
    </div>

    <!-- Sección principal después de iniciar sesión -->
    <div id="main-section" class="hidden">
      <h2 id="welcome"></h2>
      <button onclick="showAddNote()">Agregar Nota</button>
      <button onclick="showAllUsers()">Ver Usuarios Registrados</button>
      <button onclick="showChangePassword()">Cambiar Contraseña</button>
      <button onclick="showDeleteUser()">Eliminar Usuario</button>
      <button onclick="logout()">Cerrar Sesión</button>
    </div>

    <!-- Sección para agregar una nueva nota -->
    <div id="note-section" class="hidden">
      <h2>Agregar Nota</h2>
      <select id="subject">
        <option>Matematica</option>
        <option>Fisica</option>
        <option>Espanol</option>
        <option>Ingles</option>
        <option>Sociales</option>
      </select>
      <select id="term">
        <option>1er Trimestre</option>
        <option>2do Trimestre</option>
        <option>3er Trimestre</option>
      </select>
      <input id="grade" type="number" min="0" max="100" placeholder="Nota (0 - 100)">
      <button onclick="addNote()">Guardar Nota</button>
      <button onclick="backToMain()">Volver</button>
    </div>

    <!-- Sección para ver todos los usuarios -->
    <div id="users-section" class="hidden">
      <h2>Usuarios Registrados</h2>
      <div id="user-list"></div>
      <button onclick="backToMain()">Volver</button>
    </div>

    <!-- Sección para cambiar la contraseña -->
    <div id="change-pass-section" class="hidden">
      <h2>Cambiar Contraseña</h2>
      <input id="old-pass" placeholder="Contraseña actual" type="password">
      <input id="new-pass" placeholder="Nueva contraseña" type="password">
      <button onclick="changePassword()">Cambiar</button>
      <button onclick="backToMain()">Volver</button>
    </div>

    <!-- Sección para eliminar un usuario -->
    <div id="delete-section" class="hidden">
      <h2>Eliminar Usuario</h2>
      <input id="del-username" placeholder="Usuario a eliminar">
      <input id="admin-pass" placeholder="Contraseña Admin" type="password">
      <button onclick="deleteUser()">Eliminar</button>
      <button onclick="backToMain()">Volver</button>
    </div>
  </div>

  <script>
    let currentUser = null;
    const ADMIN_PASSWORD = '04190909';

    // Función para guardar los usuarios en localStorage
    function saveUsers(users) {
      localStorage.setItem('users', JSON.stringify(users));
    }

    // Función para obtener los usuarios de localStorage
    function getUsers() {
      return JSON.parse(localStorage.getItem('users') || '{}');
    }

    // Registro de un nuevo usuario
    function register() {
      const user = document.getElementById('reg-username').value.trim();
      const pass = document.getElementById('reg-password').value;
      const users = getUsers();
      if (users[user]) return alert('El usuario ya existe');
      users[user] = { password: pass, notes: [] };
      saveUsers(users);
      alert('Usuario registrado');
      toggleLogin();
    }

    // Iniciar sesión con un usuario
    function login() {
      const user = document.getElementById('login-username').value.trim();
      const pass = document.getElementById('login-password').value;
      const users = getUsers();
      if (!users[user]) return alert('Este usuario no existe');
      if (users[user].password !== pass) return alert('Contraseña incorrecta');
      currentUser = user;
      document.getElementById('welcome').textContent = 'Bienvenido, ' + user;
      toggleSections('main-section');
    }

    // Cerrar sesión
    function logout() {
      currentUser = null;
      toggleSections('auth-section');
    }

    // Función para alternar entre la pantalla de inicio de sesión y registro
    function toggleLogin() {
      document.getElementById('register-section').classList.add('hidden');
      document.getElementById('auth-section').classList.remove('hidden');
    }

    function toggleRegister() {
      document.getElementById('register-section').classList.remove('hidden');
      document.getElementById('auth-section').classList.add('hidden');
    }

    // Mostrar las opciones principales después de iniciar sesión
    function toggleSections(showId) {
      ['auth-section', 'main-section', 'note-section', 'users-section', 'change-pass-section', 'delete-section']
        .forEach(id => document.getElementById(id).classList.add('hidden'));
      document.getElementById(showId).classList.remove('hidden');
    }

    function showAddNote() { toggleSections('note-section'); }
    function showAllUsers() {
      toggleSections('users-section');
      const users = getUsers();
      const list = document.getElementById('user-list');
      list.innerHTML = '';
      for (const [name, data] of Object.entries(users)) {
        const box = document.createElement('div');
        box.innerHTML = `<strong>${name}</strong><br>` +
          data.notes.map((n, i) => `<div class="note ${n.grade<70?'red':'green'}">${n.subject} - ${n.term}: ${n.grade}</div>`).join('');
        list.appendChild(box);
      }
    }

    function showChangePassword() { toggleSections('change-pass-section'); }
    function showDeleteUser() { toggleSections('delete-section'); }

    // Agregar una nueva nota
    function addNote() {
      const subject = document.getElementById('subject').value;
      const term = document.getElementById('term').value;
      const grade = parseInt(document.getElementById('grade').value);
      if (isNaN(grade) || grade < 0 || grade > 100) return alert('Nota inválida');
      const users = getUsers();
      users[currentUser].notes.push({ subject, term, grade });
      saveUsers(users);
      alert('Nota agregada');
      backToMain();
    }

    function backToMain() { toggleSections('main-section'); }

    // Cambiar la contraseña del usuario
    function changePassword() {
      const oldPass = document.getElementById('old-pass').value;
      const newPass = document.getElementById('new-pass').value;
      const users = getUsers();
      if (users[currentUser].password !== oldPass) return alert('Contraseña actual incorrecta');
      users[currentUser].password = newPass;
      saveUsers(users);
      alert('Contraseña cambiada');
      backToMain();
    }

    // Eliminar un usuario
    function deleteUser() {
      const userToDelete = document.getElementById('del-username').value;
      const adminPass = document.getElementById('admin-pass').value;
      const users = getUsers();
      if (adminPass !== ADMIN_PASSWORD) return alert('Contraseña de administrador incorrecta');
      if (!users[userToDelete]) return alert('Este usuario no existe');
      delete users[userToDelete];
      saveUsers(users);
      alert('Usuario eliminado');
      backToMain();
    }
  </script>
</body>
</html>


